---
title: "2017 Midterm2 Practice"
author: "b06208001 龔泓愷"
date: "2018年11月27日"
output: html_document
---
##1
設台大學生中，外籍學生的比例為12%。    
若隨機調查400位台大學生，令p表此400人為外籍學生的比例。   
求p的抽樣誤差不超過3%的近似機率。

抽樣誤差不超過3%：[0.09, 0.15]
```{r}
p <- 0.12;n <- 400
se <- sqrt(p*(1-p)/n);se
pLeft <- pnorm(0.09, mean = p, sd = se);pLeft
prop <- (0.5 - pLeft)*2;prop#計算0.09~p~0.15的累積機率
```

**p的抽樣誤差不超過3%的近似機率為0.9351618。**    

##2
台大學生贊成於校內設立公共自行車租借站的比例是62%。    
請在顯著水準為0.05的情況下，回答下列問題：   

###(a)    
假設學生意見無改變，若現在隨機抽樣調查400人，   
則在此400人中贊成的比例在64.5%以上的機率是多少。    
```{r}
p <- 0.62;n <- 400; alpha <- 0.05
se <- sqrt(p*(1-p)/n);se
pnorm(0.645, mean = p, sd = se, lower.tail = F)
```

**此400人中贊成的比例在64.5%以上的機率是0.1514799**。   

###(b)    
假設實際進行抽樣調查所獲得的結果為贊成比例恰巧等於64.5%。      
而台大校方宣稱因為調查的贊成比例與過往差不多，顯見學生意願並未提高，    
所以暫緩此議題的討論。請問校方是否能夠這樣宣稱？ 

**Step1**   
H0：學生意願 = 0.62    
Ha：學生意願 > 0.62   

**Step2**   
```{r}
n*p;n*(1-p)
```
Both np & n(1-p) >= 10    
所以我們能使用單一母體比例的假說檢定(HT about a Population Proportion)    
```{r}
p_hat <- 0.645
z_value = (p_hat - p)/se;z_value
```

**Step3**   
```{r}
p_value = pnorm(z_value, lower.tail = F);p_value#單尾假說檢定
```

**Step4**   
P_value約為0.1515，大於顯著水準，我們無法推翻虛無假說。   

**Step5**   
**即使最新抽樣結果大於虛無假設，樣本卻沒有提供足夠證據推翻虛無假說。    
既然我們無法拒絕校方的宣稱，我們就不能下學生意願提高的結論，    
因為我們無法拒絕校方宣稱屬實的可能性**

###(c)    
學生會決定要在第二次抽樣調查中增加調查的樣本數，    
好讓統計檢定的結果為顯著。    
請問在贊成比例維持 64.5%的假設下，    
學生會至少要調查多少的樣本數才能達到目的？  
```{r}
z_thres <- qnorm(0.95);z_thres
n_thres = z_thres^2 * p * (1-p) / (p_hat - p)^2;n_thres
```

**需要1020樣本數才能達到目的**

##3   
下列為台北市和高雄市近2年來的每週紫爆日數紀錄。   
請根據此資料在顯著水準為0.05的情況下，回答下列問題：   

台北：

紫爆日數|0  |1  |2  |3  |4  |5  |6  |7   
--------|---|---|---|---|---|---|---|---      
周次    |20 |36 |27 |11 |3  |1  |1  |1    

高雄：

紫爆日數|0  |1  |2  |3  |4  |5  |6  |7   
--------|---|---|---|---|---|---|---|---      
周次    |2  |13 |26 |29 |19 |8  |2  |1   

###(b)    
假設中央氣象局定義一週內出現4天以上(包含4天)的紫爆日，該週即為空汙週。    
請問在近 2 年中，台北市和高雄市的空汙週比例是否存在顯著差異？     

台北空汙週數：3 + 1 + 1 + 1 = 6   
高雄空汙週數：19 + 8 + 2 + 1 = 30 

**Step1**   
H0：台北(p1)與高雄(p2)不存在差異，p1 = p2   
Ha：台北(p1)與高雄(p2)存在差異，p1 != p2    
```{r}
p1 <- 6/100;n1 = 100#台北
p2 <- 30/100;n2 = 100#高雄
```

**Step2**   
```{r}
n1*p1;n1*(1-p1)
n2*p2;n2*(1-p2)
```
雖然n1*p1未達到10，但為了繼續檢驗，假設條件通過。   
所以我們能使用兩母體比例差異的假說檢定(HT about the Difference in Two Population Proportions)    

```{r}
p_hat <- (n1*p1 + n2*p2)/(n1 + n2);p_hat
se = sqrt(p_hat*(1-p_hat)/n1 + p_hat*(1-p_hat)/n2);se
z_value = ((p1 -p2) - 0)/se;z_value
```

**Step3**   
```{r}
p_value <- pnorm(abs(z_value), lower.tail = F)*2;p_value#雙尾假說檢定
```

**Step4**   
P_value約為0.，小於顯著水準，我們能推翻虛無假說，接受另類假說。     

**Step5**   
**此樣本為統計上顯著。    
樣本提供足夠證據推翻虛無假說。    
因此，我們能下台北市和高雄市的空汙週比例是否存在顯著差異的結論。**

###(c)    

呈上題，中央氣象局局長希望可以有圖表作為向外界解說時的輔助素材。    
利用繪製信賴區間的方式，繪製台北市和高雄市的空汙週比例信賴區間於同一張圖表，    
並與(b)小題的答案做比較和說明。   

```{r}
se1 <- sqrt(p1*(1-p1)/n1);se1
se2 <- sqrt(p2*(1-p2)/n2);se2
z <- qnorm(0.975);z#雙尾檢定

#計算信賴區間
up1 <- p1 + z*se1;up1
low1 <- p1 - z*se1;low1
up2 <- p2 + z*se2;up2
low2 <- p2 - z*se2;low2

#畫圖
plot(c(0,3),type='n',xlim=c(-0.1,0.5),
     xlab='Proportion of the Air-Polluted Week',ylab='',axes=F,
     main='Comparsion of the Two Confidence Interval')

lines(c(low1, up1),c(2,2))
text(up1,2.2,labels='Taipei')
lines(c(low1, low1),c(1.95,2.05))
lines(c(p1, p1),c(1.95,2.05))
lines(c(up1, up1),c(1.95,2.05))

lines(c(low2, up2),c(1,1))
text(up2,1.2,labels='Kaohsiung')
lines(c(low2, low2),c(0.95,1.05))
lines(c(p2, p2),c(0.95,1.05))
lines(c(up2, up2),c(0.95,1.05))

axis(1)


```

